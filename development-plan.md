# 保育士業務支援アプリ開発計画

## プロジェクト概要
保育士の日常業務を効率化するWebアプリケーション。メール文作成、保育日誌作成、児童票作成機能を提供。

## 現在の技術スタック
- Next.js 15.3.4 (App Router)
- React 19
- TypeScript 5
- Tailwind CSS v4
- ESLint + PostCSS

## 追加予定技術
- Supabase (データベース・認証)
- OpenAI API (AI文章生成)

## 開発フェーズ

### Phase 1: 基盤構築 - 詳細ステップバイステップ計画

## セクション1: 環境設定・依存関係追加 (10タスク)

### 1.1 パッケージインストール
**T1-1**: Supabaseクライアントインストール
- `npm install @supabase/supabase-js`
- 完了条件: package.jsonに追加確認

**T1-2**: 認証UIコンポーネントインストール  
- `npm install @supabase/auth-ui-react @supabase/auth-ui-shared`
- 完了条件: package.jsonに追加確認

**T1-3**: フォーム管理ライブラリインストール
- `npm install react-hook-form @hookform/resolvers zod`
- 完了条件: package.jsonに追加確認

**T1-4**: OpenAI APIクライアントインストール
- `npm install openai`
- 完了条件: package.jsonに追加確認

**T1-5**: アイコンライブラリインストール
- `npm install lucide-react`
- 完了条件: package.jsonに追加確認

### 1.2 環境変数設定
**T1-6**: .env.localファイル作成
- 空の.env.localファイル作成
- 完了条件: ファイル存在確認

**T1-7**: 環境変数テンプレート作成
- NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY, OPENAI_API_KEY定義
- 完了条件: 変数名だけ定義（値は空でOK）

**T1-8**: .gitignore更新確認
- .env.localが除外されているか確認
- 完了条件: .gitignoreに.env.local記載確認

**T1-9**: 型定義用ディレクトリ作成
- `src/types/`ディレクトリ作成
- 完了条件: ディレクトリ存在確認

**T1-10**: 基本依存関係テスト
- `npm run build`実行してエラーがないか確認
- 完了条件: ビルド成功

## セクション2: Supabase設定・データベース構築 (8タスク)

**T2-1**: Supabaseクライアント設定ファイル作成
- `src/lib/supabase.ts`作成（基本的なクライアント初期化のみ）
- 完了条件: ファイル作成、型エラーなし

**T2-2**: データベース型定義ファイル作成
- `src/types/database.ts`作成（空のinterfaces定義）
- 完了条件: ファイル作成、基本型定義

**T2-3**: usersテーブル型定義
- User profile関連の型定義追加
- 完了条件: TypeScript型定義完成

**T2-4**: classesテーブル型定義
- Class（こあら組、くま組、きりん組）関連の型定義
- 完了条件: TypeScript型定義完成

**T2-5**: childrenテーブル型定義
- Children関連の型定義追加
- 完了条件: TypeScript型定義完成

**T2-6**: generation_historyテーブル型定義
- AI生成履歴関連の型定義追加
- 完了条件: TypeScript型定義完成

**T2-7**: child_recordsテーブル型定義
- 児童票関連の型定義追加
- 完了条件: TypeScript型定義完成

**T2-8**: データベース型定義テスト
- 全型定義ファイルのTypeScriptコンパイル確認
- 完了条件: `npm run build`成功

## セクション3: 認証システム実装 (12タスク)

**T3-1**: 認証コンテキストファイル作成
- `src/lib/auth.tsx`作成（空のコンテキスト）
- 完了条件: ファイル作成、基本構造定義

**T3-2**: 認証フック作成
- useAuthフック作成（基本構造のみ）
- 完了条件: フック定義、型安全性確認

**T3-3**: ログインページディレクトリ作成
- `src/app/login/`ディレクトリ作成
- 完了条件: ディレクトリ存在確認

**T3-4**: ログインページファイル作成
- `src/app/login/page.tsx`作成（基本JSX構造のみ）
- 完了条件: ページアクセス可能、レンダリング成功

**T3-5**: 新規登録ページディレクトリ作成
- `src/app/register/`ディレクトリ作成
- 完了条件: ディレクトリ存在確認

**T3-6**: 新規登録ページファイル作成
- `src/app/register/page.tsx`作成（基本JSX構造のみ）
- 完了条件: ページアクセス可能、レンダリング成功

**T3-7**: 認証状態型定義
- `src/types/auth.ts`作成
- 完了条件: User, Session等の型定義完成

**T3-8**: ログインフォームコンポーネント作成
- 基本的なemail/password入力フォーム
- 完了条件: フォーム表示、バリデーション動作

**T3-9**: 新規登録フォームコンポーネント作成
- email/password + 担当クラス選択フォーム
- 完了条件: フォーム表示、バリデーション動作

**T3-10**: 認証ガードミドルウェア作成
- `src/middleware.ts`作成（基本構造のみ）
- 完了条件: ファイル作成、Next.js認識確認

**T3-11**: 保護ルート設定
- ダッシュボード等の保護ルート定義
- 完了条件: 未認証時のリダイレクト動作確認

**T3-12**: 認証フロー統合テスト
- ログイン→ダッシュボード→ログアウトフロー確認
- 完了条件: 基本認証フロー動作（実際のSupabase接続前）

## セクション4: 基本UI/UX構築 (15タスク)

**T4-1**: UIコンポーネントディレクトリ作成
- `src/components/ui/`ディレクトリ作成
- 完了条件: ディレクトリ存在確認

**T4-2**: Buttonコンポーネント作成
- `src/components/ui/Button.tsx`基本実装
- 完了条件: ボタン表示、クリック動作確認

**T4-3**: Inputコンポーネント作成
- `src/components/ui/Input.tsx`基本実装
- 完了条件: 入力フィールド表示、入力動作確認

**T4-4**: Cardコンポーネント作成
- `src/components/ui/Card.tsx`基本実装
- 完了条件: カード表示確認

**T4-5**: Loadingコンポーネント作成
- `src/components/ui/Loading.tsx`基本実装
- 完了条件: ローディング表示確認

**T4-6**: Layoutコンポーネント作成
- `src/components/Layout.tsx`基本実装
- 完了条件: レイアウト表示確認

**T4-7**: Headerコンポーネント作成
- `src/components/Header.tsx`基本実装
- 完了条件: ヘッダー表示確認

**T4-8**: Navigationコンポーネント作成
- `src/components/Navigation.tsx`基本実装
- 完了条件: ナビゲーション表示確認

**T4-9**: ダッシュボードディレクトリ作成
- `src/app/dashboard/`ディレクトリ作成
- 完了条件: ディレクトリ存在確認

**T4-10**: ダッシュボードページ作成
- `src/app/dashboard/page.tsx`基本実装
- 完了条件: ページ表示、基本レイアウト確認

**T4-11**: TOPページ更新
- `src/app/page.tsx`をLP仕様に更新
- 完了条件: LP表示、ログイン導線確認

**T4-12**: レスポンシブデザイン基本設定
- Tailwind CSS設定でモバイルファースト確認
- 完了条件: 320px-1920px表示確認

**T4-13**: 機能選択カードコンポーネント作成
- メール文・保育日誌・児童票の選択カード
- 完了条件: カード表示、クリック動作確認

**T4-14**: 基本スタイル統合
- 全コンポーネントのスタイル統一確認  
- 完了条件: デザイン一貫性確認

**T4-15**: UI統合テスト
- 全画面遷移、レスポンシブ動作確認
- 完了条件: 基本UI動作確認

## セクション5: データベース接続・基本CRUD (8タスク)

**T5-1**: データベース操作関数ファイル作成
- `src/lib/database.ts`作成（空の関数定義）
- 完了条件: ファイル作成、基本構造定義

**T5-2**: ユーザープロファイル取得関数実装
- getUserProfile関数実装
- 完了条件: 関数実装、型安全性確認

**T5-3**: ユーザープロファイル更新関数実装
- updateUserProfile関数実装
- 完了条件: 関数実装、型安全性確認

**T5-4**: クラス情報取得関数実装
- getClasses関数実装
- 完了条件: 関数実装、型安全性確認

**T5-5**: 園児情報取得関数実装
- getChildren関数実装（クラス別フィルタ含む）
- 完了条件: 関数実装、型安全性確認

**T5-6**: 生成履歴保存関数実装
- saveGenerationHistory関数実装
- 完了条件: 関数実装、型安全性確認

**T5-7**: データベース接続テスト関数作成
- 接続確認用のテスト関数実装
- 完了条件: 接続テスト実行可能

**T5-8**: CRUD統合テスト
- 全データベース関数の動作確認
- 完了条件: 基本CRUD動作確認（モック環境）

## 並列実装可能な組み合わせ

### 第1波: 3つのAgentで並列実行
- **Agent A**: 環境設定・依存関係 (T1-1～T1-10)
- **Agent B**: 型定義システム (T2-2～T2-7, T3-7)  
- **Agent C**: 基本UIコンポーネント (T4-1～T4-5)

### 第2波: 統合・認証準備 (第1波完了後)
- **Single Agent**: Supabase・認証基盤 (T2-1, T3-1, T3-2, T2-8)

### 第3波: 認証ページ (第2波完了後)
- **Agent E**: ログイン機能 (T3-3, T3-4, T3-8)
- **Agent F**: 登録機能 (T3-5, T3-6, T3-9)
- **Agent D**: レイアウト・ページ構造 (T4-6～T4-8, T4-11～T4-13, T4-12)

### 第4波以降: 順次統合
- **Single Agent**: 認証システム統合 (T3-10～T3-12)
- **Single Agent**: ダッシュボード・最終統合 (T4-9, T4-10, T4-14, T4-15)
- **Agent G**: データベース操作 (T5-1～T5-8)

## 実行順序と依存関係
各タスク完了後に`npm run build`と`npm run lint`でエラーチェックを実施

### 重要な確認事項
- **園児名は絶対に入れない**: メール文・保育日誌はクラス全体の内容として生成
- **認証フロー**: TOP/LP → ログイン → ダッシュボード → 各機能
- **3パターン生成**: メール文（親しみやすい文体）、保育日誌（記録文体）

### Phase 2: 主要機能実装（優先順位順）
1. **メール文作成機能**
   - キーワード入力UI
   - OpenAI API連携
   - 3パターン生成・コピー機能

2. **保育日誌作成機能**
   - メール文と同様のUI
   - 記録文体での生成

3. **児童票作成機能**
   - 6項目入力フォーム
   - 履歴管理機能
   - アクセス制御

### Phase 3: 最適化・追加機能
1. **パフォーマンス最適化**
2. **音声入力機能（Web Speech API）**
3. **エラーハンドリング・ログ機能**

## 主要要件（参考）
### 機能要件
- メール文作成（保護者向け、3パターン生成）
- 保育日誌作成（園内記録用、記録文体）
- 児童票作成（6項目、履歴管理）
- クラス制限アクセス（こあら組、くま組、きりん組）

### 非機能要件
- モバイルファースト（スマートフォンメイン利用）
- AI生成3秒以内応答
- HTTPS通信・データ暗号化
- 主要ブラウザ対応

### UI/UX要件
- シンプル・直感的操作
- ワンタップコピー機能
- レスポンシブデザイン（320px〜1920px）

## 進行状況
- [x] 要件定義書確認
- [x] 技術スタック確認
- [x] Phase 1 詳細計画策定
- [ ] Phase 1 実装開始

## 注意事項
各フェーズで動作確認とテストを実施し、段階的にデプロイする。
セキュリティ・プライバシー要件に特に注意して実装する。